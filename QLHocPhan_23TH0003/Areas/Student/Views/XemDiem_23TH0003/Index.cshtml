@model IEnumerable<QLHocPhan_23TH0003.Models.DangKyHocPhan>
@{
    ViewBag.Title = "Kết quả học tập";
}

<style>
    .title {
        font-size: 30px;
        color: #d60000;
        font-weight: 700;
        margin-top: 30px;
        text-transform: uppercase;
        position: relative;
    }

        .title::after {
            content: "";
            display: block;
            width: 60px;
            height: 4px;
            background-color: #007bff;
            margin: 8px auto 0;
            border-radius: 2px;
        }

    .term-title {
        font-size: 20px;
        font-weight: 600;
        color: #0d6efd;
        margin: 30px 0 10px;
    }

    table {
        border-radius: 8px;
        overflow: hidden;
    }

    thead {
        background-color: #00c9ff;
        color: #fff;
        font-weight: bold;
        text-align: center;
    }

    tbody tr:nth-child(odd) {
        background-color: #f7f7f7;
    }

    tbody tr:nth-child(even) {
        background-color: #ffffff;
    }

    table th, table td {
        padding: 12px;
        text-align: center;
        vertical-align: middle;
    }

    .no-data {
        margin-top: 20px;
        font-style: italic;
        color: #888;
    }

    .print-btn {
        margin-top: 10px;
        margin-bottom: 30px;
        display: flex;
        justify-content: center;
    }
    
    @@media print {
        body *

    {
        visibility: hidden;
    }

    .print-content * {
        visibility: visible;
    }

        .print-btn{
            visibility: hidden;
        }
    .container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
    }

    .print-btn {
        display: none !important;
    }

    .navbar, .page-header, footer {
        display: none !important;
    }

    }
</style>

<div class="container mt-4">
    <div class="print-content">
        <h2 class="text-center title">@ViewBag.Title</h2>

        <div class="text-end mb-3">
            <button class="btn btn-sm btn-outline-primary print-btn" onclick="window.print()">
                <i class="fas fa-print"></i> In bảng điểm
            </button>
        </div>

        @if (Model != null && Model.Any())
        {
            var ListHocKy = Model
            .GroupBy(x => x.LopHocPhan.HocPhan.HocKy)
            .Select(x => new
            {
                Id = x.Key.Id,
                MaHocKy = x.Key.MaHocKy,
                TenHocKy = x.Key.TenHocKy,
                NamHoc = x.Key.NamHoc
            });

            foreach (var hocky in ListHocKy)
            {
                var ListDiem = Model.Where(x => x.LopHocPhan?.HocPhan?.IdHocKy == hocky.Id);
                <div class="mt-5">
                    <h4 class="term-title">@hocky.TenHocKy - @hocky.NamHoc</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover shadow-sm">
                            <thead>
                                <tr>
                                    <th>Lớp học phần</th>
                                    <th>Số tín chỉ</th>
                                    <th>Điểm giữa kì</th>
                                    <th>Điểm cuối kì</th>
                                    <th>Điểm TB</th>
                                    <th>Xếp loại</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ListDiem)
                                {
                                    <tr>
                                        <td>@item?.LopHocPhan?.TenLopHocPhan</td>
                                        <td>@item?.LopHocPhan?.HocPhan?.SoTinChi</td>
                                        <td>@item?.Diem?.DiemGiuaKy?.ToString("0.00")</td>
                                        <td>@item?.Diem?.DiemCuoiKy?.ToString("0.00")</td>
                                        <td>@item?.Diem?.DiemTrungBinh?.ToString("0.00")</td>
                                        <td>@item?.Diem?.XepLoai</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-center no-data">Không có dữ liệu học tập nào được tìm thấy.</p>
        }
    </div>
    
</div>
